<div class="reports-container">
  <!-- Reports Header -->
  <div class="reports-header">
    <div class="header-content">
      <div class="header-left">
        <h2 class="reports-title">
          <svg class="reports-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M3 3v18h18" stroke="currentColor" stroke-width="2" stroke-linecap="round"
              stroke-linejoin="round" />
            <path d="M7 14l4-4 4 4 4-4" stroke="currentColor" stroke-width="2" stroke-linecap="round"
              stroke-linejoin="round" />
          </svg>
          Sales Reports
        </h2>
        <p class="reports-subtitle">Analytics and insights for your business</p>
      </div>
      <div class="header-actions">
        <!-- Date Range Picker -->
        <div class="date-range-picker">
          <div class="date-inputs">
            <div class="date-input-group">
              <label for="startDate">From:</label>
              <input type="date" id="startDate" [value]="startDate.toISOString().split('T')[0]"
                (change)="onStartDateChange($event)" class="date-input">
            </div>
            <div class="date-input-group">
              <label for="endDate">To:</label>
              <input type="date" id="endDate" [value]="endDate.toISOString().split('T')[0]"
                (change)="onEndDateChange($event)" class="date-input">
            </div>
          </div>
          <button class="btn btn-outline" (click)="resetToToday()" [disabled]="!isCustomDateRange"
            title="Reset to today's view">
            Today
          </button>
        </div>

        <button class="btn btn-secondary" (click)="refreshReports()" [disabled]="isLoading">
          <svg class="btn-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M1 4v6h6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
            <path d="M23 20v-6h-6" stroke="currentColor" stroke-width="2" stroke-linecap="round"
              stroke-linejoin="round" />
            <path d="M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15" stroke="currentColor"
              stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
          </svg>
          {{ isLoading ? 'Loading...' : 'Refresh' }}
        </button>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-container">
    <div class="loading-spinner">
      <svg class="spinner" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" stroke-linecap="round"
          stroke-dasharray="31.416" stroke-dashoffset="31.416">
          <animate attributeName="stroke-dasharray" dur="2s" values="0 31.416;15.708 15.708;0 31.416"
            repeatCount="indefinite" />
          <animate attributeName="stroke-dashoffset" dur="2s" values="0;-15.708;-31.416" repeatCount="indefinite" />
        </circle>
      </svg>
      <p class="loading-text">Loading reports...</p>
    </div>
  </div>

  <!-- Reports Content -->
  <div class="reports-content" *ngIf="!isLoading">
    <!-- Error State -->
    <div *ngIf="errorMessage" class="error-container">
      <div class="error-icon">
        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" />
          <line x1="15" y1="9" x2="9" y2="15" stroke="currentColor" stroke-width="2" stroke-linecap="round"
            stroke-linejoin="round" />
          <line x1="9" y1="9" x2="15" y2="15" stroke="currentColor" stroke-width="2" stroke-linecap="round"
            stroke-linejoin="round" />
        </svg>
      </div>
      <p class="error-text">{{ errorMessage }}</p>
      <button class="btn btn-primary" (click)="refreshReports()">Try Again</button>
    </div>

    <!-- Empty State -->
    <div *ngIf="!errorMessage && !hasData() && allTimeProductSales.length === 0" class="empty-state">
      <div class="empty-icon">
        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M3 3v18h18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
          <path d="M7 14l4-4 4 4 4-4" stroke="currentColor" stroke-width="2" stroke-linecap="round"
            stroke-linejoin="round" />
        </svg>
      </div>
      <h3 class="empty-title">Today's Summary - No Sales Yet</h3>
      <p class="empty-description">
        It's {{ today | date:'EEEE, MMMM d, y' }} and no sales have been recorded yet today.
        The reports below show today's current status. Start making sales to see your daily metrics here.
      </p>
      <div class="empty-actions">
        <button class="btn btn-primary" routerLink="/products">
          <svg class="btn-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 5v14M5 12h14" stroke="currentColor" stroke-width="2" stroke-linecap="round"
              stroke-linejoin="round" />
          </svg>
          Start Selling
        </button>
        <button class="btn btn-secondary" (click)="refreshReports()">
          <svg class="btn-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M1 4v6h6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
            <path d="M23 20v-6h-6" stroke="currentColor" stroke-width="2" stroke-linecap="round"
              stroke-linejoin="round" />
            <path d="M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15" stroke="currentColor"
              stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
          </svg>
          Refresh
        </button>
      </div>
    </div>

    <!-- Export Controls -->
    <div *ngIf="!errorMessage && hasData()" class="export-controls">
      <div class="export-section">
        <h3 class="export-title">Export Reports</h3>
        <p class="export-description">Download your reports data in various formats</p>
        <div class="export-buttons">
          <button class="btn btn-export btn-csv" (click)="exportData('csv')" title="Export as CSV file">
            <svg class="btn-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" stroke="currentColor"
                stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
              <polyline points="14,2 14,8 20,8" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                stroke-linejoin="round" />
              <line x1="16" y1="13" x2="8" y2="13" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                stroke-linejoin="round" />
              <line x1="16" y1="17" x2="8" y2="17" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                stroke-linejoin="round" />
              <polyline points="10,9 9,9 8,9" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                stroke-linejoin="round" />
            </svg>
            Export CSV
          </button>
          <button class="btn btn-export btn-excel" (click)="exportData('excel')" title="Export as Excel file">
            <svg class="btn-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" stroke="currentColor"
                stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
              <polyline points="14,2 14,8 20,8" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                stroke-linejoin="round" />
              <path d="M8 13l3 3 5-5" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                stroke-linejoin="round" />
            </svg>
            Export Excel
          </button>
          <button class="btn btn-export btn-pdf" (click)="exportData('pdf')" title="Export as PDF file (Coming Soon)">
            <svg class="btn-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" stroke="currentColor"
                stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
              <polyline points="14,2 14,8 20,8" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                stroke-linejoin="round" />
              <path d="M9 15h6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
              <path d="M9 11h6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
            </svg>
            Export PDF
          </button>
        </div>
      </div>
    </div>

    <!-- All-Time Product Sales Card (Always Visible) -->
    <div *ngIf="!errorMessage" class="all-time-sales-section-compact">
      <div class="compact-header">
        <div class="compact-title-group">
          <h3 class="compact-title">
            <svg class="compact-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" stroke="currentColor"
                stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
            </svg>
            All-Time Leaderboard
          </h3>
          <p class="compact-subtitle">Lifetime product performance</p>
        </div>
        
        <div class="compact-controls">
          <div class="compact-search">
            <svg class="compact-search-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <input type="text" [(ngModel)]="allTimeSearchQuery" placeholder="Quick search..." class="compact-search-input">
          </div>
          <div class="compact-sort">
            <select [(ngModel)]="allTimeSortBy" class="compact-sort-select">
              <option value="sales">üí∞ Revenue</option>
              <option value="quantity">üì¶ Sold</option>
              <option value="name">üî§ Name</option>
            </select>
          </div>
        </div>
      </div>

      <div class="compact-category-filters">
        <button class="compact-category-btn" [class.active]="allTimeSelectedCategory === 'all'"
          (click)="selectAllTimeCategory('all')">
          All
        </button>
        <button *ngFor="let category of allTimeCategories" class="compact-category-btn"
          [class.active]="allTimeSelectedCategory === category" (click)="selectAllTimeCategory(category)">
          {{ category }}
        </button>
      </div>

      <div class="compact-grid-container">
        <div *ngIf="filteredAllTimeSales.length === 0" class="compact-empty">
          <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" width="24" height="24">
            <path d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          No products found
        </div>
        
        <div *ngFor="let product of filteredAllTimeSales; let i = index" class="compact-item" [title]="product.name + ' - Last sold: ' + (product.lastSoldDate ? formatDate(product.lastSoldDate) : 'Never')">
          <div class="compact-rank-badge" [class.rank-top]="i < 3">
            {{ i + 1 }}
          </div>
          
          <div class="compact-content">
            <div class="compact-name-row">
              <span class="compact-name">{{ product.name }}</span>
              <span class="compact-cat-tag">{{ product.category }}</span>
            </div>
            
            <div class="compact-data-row">
              <div class="compact-metric">
                <span class="metric-label">Revenue</span>
                <span class="metric-value revenue">{{ formatCurrency(product.sales) }}</span>
              </div>
              <div class="compact-divider"></div>
              <div class="compact-metric">
                <span class="metric-label">Sold</span>
                <span class="metric-value units">{{ product.quantity }}</span>
              </div>
            </div>
            
            <div class="compact-mini-progress">
              <div class="progress-fill sales" [style.width.%]="(product.sales / getMaxAllTimeSales()) * 100"></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Reports Grid -->
    <div *ngIf="!errorMessage && hasData()" class="reports-grid">
      <!-- Daily Summary Card -->
      <div class="report-card summary-card">
        <div class="card-header">
          <h3 class="card-title">
            <svg class="card-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <rect x="3" y="4" width="18" height="18" rx="2" ry="2" stroke="currentColor" stroke-width="2" />
              <line x1="16" y1="2" x2="16" y2="6" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                stroke-linejoin="round" />
              <line x1="8" y1="2" x2="8" y2="6" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                stroke-linejoin="round" />
              <line x1="3" y1="10" x2="21" y2="10" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                stroke-linejoin="round" />
            </svg>
            {{ getSummaryTitle() }}
          </h3>
          <span class="card-date">{{ getDateRangeLabel() }}</span>
        </div>

        <div class="card-body">
          <div class="summary-stats">
            <div class="stat-item">
              <div class="stat-value">{{ formatCurrency(getTotalSales()) }}</div>
              <div class="stat-label">Total Sales</div>
            </div>
            <div class="stat-item">
              <div class="stat-value">{{ getTransactionCount() }}</div>
              <div class="stat-label">Transactions</div>
            </div>
            <div class="stat-item">
              <div class="stat-value">{{ formatCurrency(getAverageTransactionValue()) }}</div>
              <div class="stat-label">Avg. Order</div>
            </div>
            <div class="stat-item">
              <div class="stat-value">{{ getTopProductName() }}</div>
              <div class="stat-label">Top Product</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Sales Chart Card -->
      <div class="report-card chart-card">
        <div class="card-header">
          <h3 class="card-title">
            <svg class="card-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M3 3v18h18" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                stroke-linejoin="round" />
              <path d="M7 14l4-4 4 4 4-4" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                stroke-linejoin="round" />
            </svg>
            Sales Trend
          </h3>
          <!-- Trend Period Selector -->
          <div class="trend-controls">
            <div class="trend-period-selector">
              <button class="period-btn" [class.active]="trendPeriod === '7d'" (click)="onTrendPeriodChange('7d')">
                7D
              </button>
              <button class="period-btn" [class.active]="trendPeriod === '30d'" (click)="onTrendPeriodChange('30d')">
                30D
              </button>
              <button class="period-btn" [class.active]="trendPeriod === '90d'" (click)="onTrendPeriodChange('90d')">
                90D
              </button>
            </div>
          </div>
        </div>

        <div class="card-body">
          <!-- Sales Trend Chart -->
          <div class="sales-chart" *ngIf="chartData.length > 0">
            <div class="chart-container">
              <div *ngFor="let data of chartData; let i = index" class="chart-bar"
                [style.height.%]="getBarHeight(data.sales)" [style.background]="data.color"
                [title]="data.formattedDate + ': ' + formatCurrency(data.sales)">
                <div class="bar-value">
                  {{ formatCurrency(data.sales) }}
                </div>
              </div>
            </div>
            <div class="chart-labels">
              <span *ngFor="let data of chartData">{{ data.formattedDate }}</span>
            </div>
          </div>

          <!-- Empty State for Chart -->
          <div class="chart-empty-state" *ngIf="chartData.length === 0">
            <svg class="chart-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M3 3v18h18" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                stroke-linejoin="round" />
              <path d="M7 14l4-4 4 4 4-4" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                stroke-linejoin="round" />
            </svg>
            <p class="chart-text">No sales data available for the selected period</p>
          </div>
        </div>
      </div>

      <!-- Top Products Card -->
      <div class="report-card">
        <div class="card-header">
          <h3 class="card-title">
            <svg class="card-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4" stroke="currentColor"
                stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
            </svg>
            Top Products
          </h3>
        </div>

        <div class="card-body">
          <div class="products-list">
            <div *ngIf="topProducts.length === 0" class="empty-list">
              <p>No top products data available</p>
            </div>
            <div *ngFor="let product of topProducts; let i = index" class="product-item">
              <div class="product-rank">
                <span class="rank-number">{{ i + 1 }}</span>
              </div>
              <div class="product-info">
                <span class="product-name">{{ product.name }}</span>
                <span class="product-category">{{ product.category }}</span>
              </div>
              <div class="product-stats">
                <span class="product-sales">{{ formatCurrency(product.sales) }}</span>
                <span class="product-quantity">{{ product.quantity }} sold</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Recent Transactions Card -->
      <div class="report-card">
        <div class="card-header">
          <h3 class="card-title">
            <svg class="card-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M9 22a1 1 0 1 0 0-2 1 1 0 0 0 0 2z" fill="currentColor" />
              <path d="M20 22a1 1 0 1 0 0-2 1 1 0 0 0 0 2z" fill="currentColor" />
              <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6" stroke="currentColor"
                stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
            </svg>
            Recent Transactions
          </h3>
        </div>

        <div class="card-body">
          <div class="transactions-list">
            <div *ngIf="recentTransactions.length === 0" class="empty-list">
              <p>No recent transactions data available</p>
            </div>
            <div *ngFor="let transaction of recentTransactions" class="transaction-item"
              (click)="openTransactionDetails(transaction)" style="cursor: pointer;" title="Click to view details">
              <div class="transaction-info">
                <span class="transaction-id">#{{ transaction.id }}</span>
                <span class="transaction-time">{{ formatDateTime(transaction.timestamp) }}</span>
              </div>
              <div class="transaction-details">
                <span class="transaction-items">{{ transaction.items.length }} items</span>
                <span class="transaction-total">{{ formatCurrency(transaction.total) }}</span>
              </div>
              <div class="transaction-status">
                <span class="status-badge" [class]="'status-' + transaction.status">
                  {{ transaction.status }}
                </span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Performance Metrics Card -->
      <div class="report-card metrics-card">
        <div class="card-header">
          <h3 class="card-title">
            <svg class="card-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" />
              <path d="M12 6v6l4 2" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                stroke-linejoin="round" />
            </svg>
            Performance Metrics
          </h3>
        </div>

        <div class="card-body">
          <!-- Trend Period Selector -->
          <div class="trend-controls" style="margin-bottom: 1rem;">
            <div class="trend-period-selector">
              <button class="period-btn" [class.active]="trendPeriod === '7d'" (click)="onTrendPeriodChange('7d')">
                7D
              </button>
              <button class="period-btn" [class.active]="trendPeriod === '30d'" (click)="onTrendPeriodChange('30d')">
                30D
              </button>
              <button class="period-btn" [class.active]="trendPeriod === '90d'" (click)="onTrendPeriodChange('90d')">
                90D
              </button>
            </div>
          </div>

          <!-- Dynamic Metrics -->
          <div class="metrics-grid">
            <div class="metric-item">
              <div class="metric-icon" [class]="chartData.length > 0 ? getTrendInsights().trend : 'neutral'">
                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M12 5v14M5 12h14" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                    stroke-linejoin="round" />
                </svg>
              </div>
              <div class="metric-content">
                <div class="metric-value">
                  <span *ngIf="chartData.length > 0">{{ getTrendInsights().percentage > 0 ? '+' : '' }}{{
                    getTrendInsights().percentage.toFixed(1) }}%</span>
                  <span *ngIf="chartData.length === 0">0.0%</span>
                </div>
                <div class="metric-label">Sales Growth</div>
              </div>
            </div>

            <div class="metric-item">
              <div class="metric-icon positive">
                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M12 5v14M5 12h14" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                    stroke-linejoin="round" />
                </svg>
              </div>
              <div class="metric-content">
                <div class="metric-value">{{ getTransactionCount() }}</div>
                <div class="metric-label">Total Transactions</div>
              </div>
            </div>

            <div class="metric-item">
              <div class="metric-icon neutral">
                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M12 5v14M5 12h14" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                    stroke-linejoin="round" />
                </svg>
              </div>
              <div class="metric-content">
                <div class="metric-value">{{ formatCurrency(getAverageTransactionValue()) }}</div>
                <div class="metric-label">Avg. Order Value</div>
              </div>
            </div>

            <div class="metric-item">
              <div class="metric-icon positive">
                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M12 5v14M5 12h14" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                    stroke-linejoin="round" />
                </svg>
              </div>
              <div class="metric-content">
                <div class="metric-value">{{ formatCurrency(getTotalSales()) }}</div>
                <div class="metric-label">Total Sales</div>
              </div>
            </div>
          </div>



          <!-- Trend Data Status -->
          <div class="trend-status" style="margin-top: 1rem; text-align: center; font-size: 0.875rem; color: #64748b;">
            <span *ngIf="chartData.length > 0">Showing {{ trendPeriod }} trend data</span>
            <span *ngIf="chartData.length === 0">No trend data available for {{ trendPeriod }} period</span>
          </div>
        </div>
      </div>
    </div>

  </div>
</div>

<!-- Transaction Details Modal -->
<div class="modal-backdrop" *ngIf="isTransactionModalOpen" (click)="closeTransactionModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3 class="modal-title">Transaction Details</h3>
      <button class="close-btn" (click)="closeTransactionModal()">&times;</button>
    </div>

    <div class="modal-body" *ngIf="selectedTransaction">
      <div class="receipt-content">
        <!-- Store Header -->
        <div class="store-header">
          <h3>finnbites POS</h3>
          <p>Point of Sale Terminal</p>
          <p>{{ formatDateTime(selectedTransaction.timestamp || '') }}</p>
        </div>

        <!-- Transaction Details -->
        <div class="receipt-transaction-details">
          <div class="detail-row">
            <span>Receipt #:</span>
            <span>{{ getReceiptNumber(selectedTransaction) }}</span>
          </div>
          <div class="detail-row">
            <span>Payment Method:</span>
            <span>{{ getPaymentMethodDisplay(selectedTransaction.paymentMethod) }}</span>
          </div>
          <div class="detail-row" *ngIf="selectedTransaction.serviceType">
            <span>Service Type:</span>
            <span>{{ selectedTransaction.serviceType === 'dineIn' ? 'Dine-in' : 'Take-out' }}</span>
          </div>
          <div class="detail-row" *ngIf="selectedTransaction.customerInfo.name">
            <span>Customer:</span>
            <span>{{ selectedTransaction.customerInfo.name }}</span>
          </div>
          <div class="detail-row" *ngIf="selectedTransaction.customerInfo.phone">
            <span>Phone:</span>
            <span>{{ selectedTransaction.customerInfo.phone }}</span>
          </div>
          <div class="detail-row" *ngIf="selectedTransaction.customerInfo.email">
            <span>Email:</span>
            <span>{{ selectedTransaction.customerInfo.email }}</span>
          </div>
        </div>

        <!-- Items List -->
        <div class="items-section">
          <div class="items-header">
            <span>Item</span>
            <span>Qty</span>
            <span>Price</span>
            <span>Total</span>
          </div>

          <div class="item-row" *ngFor="let item of selectedTransaction.items">
            <div class="item-info">
              <span class="item-name">
                {{ item.name || 'Unknown Item' }}
                <span *ngIf="getTemperature(item)" class="temperature-badge" [class.hot]="isHot(item)"
                  [class.cold]="isCold(item)">
                  <span *ngIf="isHot(item)">üî• hot</span>
                  <span *ngIf="isCold(item)">‚ùÑÔ∏è Iced</span>
                </span>
              </span>
              <div class="item-addons" *ngIf="hasAddOns(item)">
                <span *ngFor="let addOn of getAddOns(item)" class="addon-item">
                  <span *ngIf="addOn.quantity && addOn.quantity > 1">{{ addOn.quantity }}x </span>+ {{ addOn.name }} ({{
                  formatPrice(addOn.price * (addOn.quantity || 1)) }})
                </span>
              </div>
            </div>
            <span class="item-qty">{{ item.quantity }}</span>
            <span class="item-price">{{ formatPrice(item.price) }}</span>
            <span class="item-total">{{ formatPrice(item.price * item.quantity) }}</span>
          </div>
        </div>

        <!-- Totals Section -->
        <div class="totals-section">
          <!-- Subtotal -->
          <div class="total-row">
            <span>Subtotal:</span>
            <span>{{ formatPrice(getSubtotal(selectedTransaction)) }}</span>
          </div>

          <!-- Discount -->
          <div class="total-row" *ngIf="getDiscountTotal(selectedTransaction) > 0">
            <span>Discount:</span>
            <span>-{{ formatPrice(getDiscountTotal(selectedTransaction)) }}</span>
          </div>

          <!-- Service Fee -->
          <div class="total-row" *ngIf="(selectedTransaction.serviceFee || 0) > 0">
            <span>Service Fee ({{ selectedTransaction.serviceType === 'dineIn' ? 'Dine-in (2%)' : 'Take-out'
              }}):</span>
            <span>{{ formatPrice(selectedTransaction.serviceFee || 0) }}</span>
          </div>

          <!-- Total -->
          <div class="total-row grand-total">
            <span>Total:</span>
            <span>{{ formatPrice(selectedTransaction.total || 0) }}</span>
          </div>

          <!-- Cash Payment Details -->
          <div *ngIf="selectedTransaction.paymentMethod === 'cash'" class="cash-payment-section">
            <div class="total-row">
              <span>Amount Received:</span>
              <span>{{ formatPrice(getAmountReceived(selectedTransaction)) }}</span>
            </div>
            <div class="total-row">
              <span>Change:</span>
              <span class="change-amount">{{ formatPrice(getChange(selectedTransaction)) }}</span>
            </div>
          </div>
        </div>

        <!-- Notes -->
        <div class="notes-section" *ngIf="selectedTransaction.notes">
          <h4>Notes:</h4>
          <p>{{ selectedTransaction.notes }}</p>
        </div>

        <!-- Footer -->
        <div class="receipt-footer">
          <p>Thank you for your purchase!</p>
          <p class="footer-note">Please keep this receipt for your records</p>
        </div>
      </div>
    </div>

    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="closeTransactionModal()">Close</button>
      <button class="btn btn-primary" (click)="printReceipt()">
        <svg class="btn-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M6 9V2h12v7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
          <path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2" stroke="currentColor"
            stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
          <path d="M6 14h12v8H6z" stroke="currentColor" stroke-width="2" stroke-linecap="round"
            stroke-linejoin="round" />
        </svg>
        Print Thermal
      </button>
    </div>
  </div>
</div>